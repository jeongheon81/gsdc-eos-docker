
systemctl stop puppet
systemctl disable puppet
systemctl stop iptables.service
systemctl disable iptables.service
systemctl mask iptables.service
systemctl start firewalld.service
systemctl enable firewalld.service
lvextend -L 50G /dev/vg_centos_jbod_mgmt_	var
xfs_growfs /dev/vg_centos_jbod_mgmt_	lv_var
sed 's/^-f 2/-f 1/' -i /etc/audit/rules.d/audit.rules
sed 's/^-e 2/-e 1/' -i /etc/audit/rules.d/immutable.rules
systemctl reboot


https://github.com/cern-eos/eos/blob/master/fst/tools/eosfstregister

docker rm -f consul-{01..09}-nginx-proxy-sidecar
docker rm -f consul-{01..09}-consul-exporter-sidecar
docker rm -f consul-{01..09}
docker rm -f grafana-01
docker rm -f loki-01
docker rm -f loki-promtail-$(hostname -s)
yes | docker container prune
yes | docker volume prune
rm -rf /etc/consul/*
rm -rf /etc/loki/*
rm -rf /etc/grafana/*
# Delete var_consul


docker rm -f eos-krb-01
docker rm -f eos-proxy-01
docker rm -f eos-qdb-{01..03}
docker rm -f eos-mgm-{01..03}
docker rm -f eos-manager-{01..09}
docker rm -f eos-fst-{0001..0018}
yes | docker container prune
yes | docker volume prune
rm -rf /etc/eos-docker/*

# Delete KeyTab

rm -rf /jbod-*/*/*
rm -rf /jbod-*/*/.eos*

ls -al /jbod-*/*/ | awk '{print $9}' | sort | uniq


http://134.75.125.53:3000
{container_name=~"eos-.*"} |~ "file1g-jbod-mgmt-09"


http://134.75.125.53:9080
https://134.75.125.55:8501


"root://jbod-mgmt-09.eoscluster.sdfarm.kr:1094//root://jbod-mgmt-01.eoscluster.sdfarm.kr:1094"
export EOS_MGM_URL="root://jbod-mgmt-01.eoscluster.sdfarm.kr:1094"


docker exec -i eos-mgm-01 sh
eos space set default on

# mgm only
eos debug notice
# to fst
eos debug /eos/*/fst


docker exec -it eos-manager-	 sh
export EOS_MGM_URL="root://jbod-mgmt-01.eoscluster.sdfarm.kr:1094"
dd if=/dev/urandom of=file1g bs=1048576 count=1024

eos mkdir /eos/gsdc/testarea/
eos chmod 777 /eos/gsdc/testarea/

eos cp file1g /eos/gsdc/testarea/file1g-$(hostname -s)
eos ls -al /eos/gsdc/testarea/

eos cp /eos/gsdc/testarea/file1g-$(hostname -s) file1g-cp

diff file1g file1g-cp

eos file info /eos/gsdc/testarea/file1g-$(hostname -s)


xrdcp -f file1g root://jbod-mgmt-01.eoscluster.sdfarm.kr:1094//eos/gsdc/testarea/file1g-$(hostname -s)

eos rm /eos/gsdc/testarea/file1g-$(hostname -s)


eos fuse mount /mnt/eos





    if [ -e /etc/eos.keytab ]; then
      chown daemon /etc/eos.keytab
      chmod 400 /etc/eos.keytab
    fi
    mkdir -p /var/eos/md /var/eos/config /var/eos/report
    chmod 700 /var/eos/md /var/eos/config
    chmod 755 /var/eos /var/eos/report
    mkdir -p /var/spool/eos/core/${2} /var/spool/eos/admin
    mkdir -p /var/log/eos /var/eos/config/${EOS_MGM_HOST}
    touch /var/eos/config/${EOS_MGM_HOST}/default.eoscf
    chown -R daemon /var/spool/eos /var/spool/eos/admin /var/log/eos
    find /var/eos/ -maxdepth 1 -mindepth 1 -not -path "/var/eos/fs" -not -path "/var/eos/fusex" -type d -exec chown -R daemon {} \;
    chmod -R 775 /var/spool/eos
    mkdir -p /var/eos/auth /var/eos/stage
    chown daemon /var/eos/auth /var/eos/stage
    setfacl -m default:u:daemon:r /var/eos/auth/


docker rm -f grafana-01
docker rm -f grafana-promtail-eos-kisti-01
docker rm -f grafana-loki
docker volume prune

rm -rf /etc/grafana/

rm -rf /var/lib/docker/volumes/eos-fst-*_data/_data/*
rm -rf /var/lib/docker/volumes/eos-qdb-*_data/_data/*
docker rm -f eos-proxy-01
docker rm -f eos-qdb-01
docker rm -f eos-qdb-02
docker rm -f eos-qdb-03
docker rm -f eos-krb-01
docker rm -f eos-mgm-01
docker rm -f eos-mgm-02
docker rm -f eos-fst-0001
docker rm -f eos-fst-0002
docker rm -f eos-fst-0003
docker rm -f eos-manager-01
docker volume prune

rm -rf /etc/eos-docker/
docker volume rm eos-fst-0001_data
docker volume rm eos-fst-0002_data
docker volume rm eos-fst-0003_data
docker volume rm eos-qdb-01_qdb
docker volume rm eos-qdb-02_qdb
docker volume rm eos-qdb-03_qdb
docker volume ls

rm -rf /var/lib/docker/volumes/eos-fst-*_data/_data/*
docker rm -f eos-fst-0004
docker rm -f eos-fst-0005
docker rm -f eos-fst-0006
docker volume prune

rm -rf /etc/eos-docker/
docker volume rm eos-fst-0004_data
docker volume rm eos-fst-0005_data
docker volume rm eos-fst-0006_data
docker volume ls


rm -rf /etc/eos-docker/eos-mgm-*

docker volume prune
docker container prune


rm -f /etc/logrotate.d/eos-*_logs


docker exec -i eos-mgm-01 /eos_mgm_fs_setup.sh 3
docker exec -it eos-manager-01 bash

docker rm -f eos-mgm-kisti01 &
docker rm -f eos-mgm-kisti02 &
docker rm -f eos-mq-kisti01 &
rm -rf /etc/eos-docker/eos-m*

redis-cli -p 7777 -h eos-qdb-01.eoscluster.sdfarm.kr -a "$(cat /etc/eos.keytab)" keys "eos-config*"
redis-cli -p 7777 -h eos-qdb-01.eoscluster.sdfarm.kr keys "eos-config*"
redis-cli -p 7777 -h eos-qdb-01.eoscluster.sdfarm.kr keys "eos-config*" | awk '{print "redis-cli -p 7777 -h eos-qdb-01.eoscluster.sdfarm.kr del "$1;}' | sh -x


grep -i warn /var/log/eos/mgm/xrdlog.mgm


docker run --privileged --pid=host -dit -h eos-client-sut.eoscluster.sut.ac.th --name eos-client-sut --net=eoscluster.sut.ac.th --net-alias=eos-client-sut --ip 202.28.43.176 eos-sut:1
docker cp /var/lib/docker/volumes/eos-krb-sut_roothome/_data/admin1.keytab eos-client-sut:/root/admin1.keytab
docker exec -i eos-krb-sut cat /etc/krb5.conf | docker exec -i eos-client-sut bash -c "cat > /etc/krb5.conf"

docker exec -i eos-client-sut kinit -kt /root/admin1.keytab admin1@SUT.EOS
docker exec -i eos-client-sut kvno host/eos-mgm-sut01.eoscluster.sut.ac.th

docker exec -i eos-client-sut bash -c "echo 'export '"EOS_MGM_URL=root://eos-mgm-sut01.eoscluster.sut.ac.th:1094" >> /root/.bashrc; source /root/.bashrc"



EOS Console [root://localhost] |/> vid enable krb5
EOS Console [root://localhost] |/> vid set map -krb5 <pwd> vuid:root vgid:root
EOS Console [root://localhost] |/> vid set membership eos-admin -uids daemon
EOS Console [root://localhost] |/> vid set membership eos-admin -gids daemon
EOS Console [root://localhost] |/> vid set membership eos-admin -uids daemon,root
EOS Console [root://localhost] |/> vid set membership eos-admin -gids daemon,root


SUT

firewall-offline-cmd --zone=internal --add-source=202.28.43.128/26
firewall-offline-cmd --zone=external --add-source=134.75.123.0/24
firewall-offline-cmd --set-default-zone=drop


systemctl start firewalld
yum install bash-completion



yum install docker-ce-cli-19.03.2-3.el7.x86_64 docker-ce-19.03.2-3.el7.x86_64


cat /etc/sudoers.d/kisti
kisti        ALL=(ALL)       NOPASSWD: ALL


eos -r root root -b fs add -m 4 d7159acf-cc61-4747-8848-7b0f5ac96ca4 eos-fst-0004.eoscluster.sdfarm.kr:1095 /data/disk0004 default rw
eos -r root root -b fs add -m 5 1b35ec0f-211c-4452-a462-3266e7836378 eos-fst-0005.eoscluster.sdfarm.kr:1095 /data/disk0005 default rw
eos -r root root -b fs add -m 6 c87dfeda-45ec-4b91-8fca-ea55a6ea8128 eos-fst-0006.eoscluster.sdfarm.kr:1095 /data/disk0006 default rw

eos -r root root -b node set eos-fst-0004.eoscluster.sdfarm.kr:1095 on
eos -r root root -b node set eos-fst-0005.eoscluster.sdfarm.kr:1095 on
eos -r root root -b node set eos-fst-0006.eoscluster.sdfarm.kr:1095 on

git checkout --orphan public-master
git remote add github -t public-master git@github.com:jeongheon81/gsdc-eos-docker.git
git push -u github public-master



git remote add github -t public-master git@github.com:jeongheon81/gsdc-eos-docker.git
git push -u github public-master
git remote show github
git config --global merge.ours.driver true
git config merge.ours.driver true


